<ion-card class="form">
  <!-- Header based on Liturgical Day -->
  <ng-container *ngIf="liturgicalDay | async as day else blankHeader">
    <ion-card-header>
      <ion-card-title>
        <h1><ldf-day-name [day]="day"></ldf-day-name></h1>
      </ion-card-title>
      <ion-card-subtitle>
        <ul class="feasts" *ngIf="day.holy_days?.length > 0 || day.week?.proper">
          <ng-container *ngFor="let holy_day of day.holy_days"><li *ngIf="holy_day.type?.rank <= 2">{{ holy_day.name }}</li></ng-container>
          <li *ngIf="day.week?.proper">({{ 'Proper' | translate }} {{ day.week.proper }})</li>
        </ul>
      </ion-card-subtitle>
    </ion-card-header>
  </ng-container>
  <!-- Header if liturgical day has not loaded -->
  <ng-template #blankHeader>
    <ion-card-header>
      <ion-card-title><ion-skeleton-text></ion-skeleton-text></ion-card-title>
      <ion-card-subtitle><ion-skeleton-text></ion-skeleton-text></ion-card-subtitle>
    </ion-card-header>
  </ng-template>

  <!-- Form -->
  <ion-card-content>
    <form name="languageVersionForm">
      <ng-container *ngIf="languageOptions$ | async as options">
        <ion-item *ngIf="options.length > 1">
          <ion-label position="stacked">{{ 'language' | translate }}</ion-label>
          <ion-select name="language" [value]="language$ | async" (ionChange)="language$.next($event.detail.value)">
            <ion-select-option *ngFor="let opt of options" [value]="opt.value">{{ opt.label }}</ion-select-option>
          </ion-select>
        </ion-item>
      </ng-container>
      <ng-container *ngIf="versionOptions$ | async as options">
        <ion-item *ngIf="options.length > 1">
          <ion-label position="stacked">{{ 'version' | translate }}</ion-label>
          <ion-select name="version" [value]="version$ | async" (ionChange)="version$.next($event.detail.value)">
            <ion-select-option *ngFor="let opt of options" [value]="opt.value">{{ opt.label }}</ion-select-option>
          </ion-select>
        </ion-item>
      </ng-container>
    </form>    

    <!-- Choose kalendars -->
    <form name="kalendarForm">
      <ng-container *ngIf="kalendarOptions | async as options">
        <ion-item *ngIf="options.length > 1">
          <ion-label position="stacked">{{ 'kalendar' | translate }}</ion-label>
          <ion-select ngDefaultControl name="formKalendar" [value]="kalendar | async" (ionChange)="kalendar.next($event.detail.value)">
            <ion-select-option *ngFor="let opt of options" [value]="opt.slug">{{ opt.name }}</ion-select-option>
          </ion-select>
        </ion-item>
      </ng-container>
      <!--<ng-container *ngIf="sanctoralOptions | async as options">
        <ion-item *ngIf="options.length > 1">
          <ion-label position="stacked">{{ 'sanctoral' | translate }}</ion-label>
          <ion-select ngDefaultControl name="formSanctoral" [value]="sanctoral | async" (ionChange)="sanctoral.next($event.detail.value)">
            <ion-select-option *ngFor="let opt of options" [value]="opt.slug">{{ opt.name }}</ion-select-option>
          </ion-select>
        </ion-item>
      </ng-container>-->
    </form>

    <!-- Choose date -->
    <venite-date [date]="startingDate$ | async" (dateChange)="date.next($event)"></venite-date>

    <!-- Choose liturgy -->
    <venite-liturgy-menu
      (liturgyChange)="liturgy.next($event)"
      (liturgyOptionsChange)="liturgyOptions$.next($event)"
      [language]="language$ | async"
      [version]="version$ | async"
      [properLiturgy]="properLiturgy | async"
    >
    </venite-liturgy-menu>

    <!-- Choose vigil -->
    <ion-item *ngIf="showVigil">
      <ion-label>{{ 'vigil' | translate }}</ion-label>
      <ion-checkbox name="isVigil" [value]="vigil | async" (ionChange)="vigil.next($event.detail.checked)"></ion-checkbox>
    </ion-item>

    <venite-proper-liturgy-menu
      [day]="liturgicalDay | async"
      [language]="(liturgy | async)?.language"
      (properLiturgyChange)="properLiturgy.next($event)"
    ></venite-proper-liturgy-menu>

    <!-- Pray Button -->
    <div class="pray-buttons">
      <ng-container *ngIf="prayButton">
        <ng-container *ngIf="prayData | async as data else notLoaded">
          <ion-button (click)="pray(data)">
            <ion-label>{{ 'Pray' | translate }}</ion-label>
          </ion-button>
        </ng-container>
        <ng-template #notLoaded>
          <ion-button disabled="true">
            <ion-label>{{ 'Pray' | translate }}</ion-label>
          </ion-button>
        </ng-template>
      </ng-container>
      <ng-container *ngIf="config?.hasBulletinMode || bulletinButton">
        <ion-button *ngIf="prayData | async as data" (click)="pray(data, true)">
          <ion-label>{{ 'Create a Bulletin' | translate }}</ion-label>
        </ion-button>
      </ng-container>
      <ng-container *ngIf="config?.prayersAndThanksgivings?.preset">
        <ion-button (click)="prayersAndThanksgivings()" fill="clear">
          <ion-label>{{ 'Choose Prayers and Thanksgivings' | translate }}</ion-label>
        </ion-button>
      </ng-container>
    </div>

    <!-- Preferences -->
    <venite-liturgy-preference-menu
      [liturgy]="liturgy | async"
      (clientPreferencesChange)="clientPreferences.next($event)"
    ></venite-liturgy-preference-menu>
  </ion-card-content>
</ion-card>