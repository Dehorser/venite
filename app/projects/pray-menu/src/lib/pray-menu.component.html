<p>Pray Menu!</p>
<ion-card class="form">
  <!-- Header based on Liturgical Day -->
  <ion-card-header *ngIf="liturgicalDay | async as day else blankHeader">
    <ion-card-title>
      &nbsp;
      <ng-container >
        <venite-liturgical-day-name [day]="day"></venite-liturgical-day-name>
      </ng-container>
    </ion-card-title>
    <ion-card-subtitle>
      <ul class="feasts" *ngIf="day.holy_days?.length > 0 || day.week?.proper">
        <li *ngFor="let holy_day of day.holy_days">{{ holy_day.name }}</li>
        <li *ngIf="day.week?.proper">({{ 'Proper' | translate }} {{ day.week.proper }})</li>
      </ul>
    </ion-card-subtitle>
  </ion-card-header>
  <!-- Header if liturgical day has not loaded -->
  <ng-template #blankHeader>
    <ion-card-header>
      <ion-card-title><ion-skeleton-text></ion-skeleton-text></ion-card-title>
      <ion-card-subtitle><ion-skeleton-text></ion-skeleton-text></ion-card-subtitle>
    </ion-card-header>
  </ng-template>

  <!-- Form -->
  <ion-card-content>
    <!-- Choose kalendars -->
    <form name="kalendarForm">
      <ng-container *ngIf="kalendarOptions | async as options">
        <ion-item *ngIf="options.length > 1">
          <ion-label position="stacked">{{ 'kalendar' | translate }}</ion-label>
          <ion-select ngDefaultControl name="formKalendar" [value]="kalendar | async" (ionChange)="kalendar.next($event.detail.value)">
            <ion-select-option *ngFor="let opt of options" [value]="opt.slug">{{ opt.name }}</ion-select-option>
          </ion-select>
        </ion-item>
      </ng-container>
      <ng-container *ngIf="sanctoralOptions | async as options">
        <ion-item *ngIf="options.length > 1">
          <ion-label position="stacked">{{ 'sanctoral' | translate }}</ion-label>
          <ion-select ngDefaultControl name="formSanctoral" [value]="sanctoral | async" (ionChange)="sanctoral.next($event.detail.value)">
            <ion-select-option *ngFor="let opt of options" [value]="opt.slug">{{ opt.name }}</ion-select-option>
          </ion-select>
        </ion-item>
      </ng-container>
    </form>

    <!-- Choose date -->
    <venite-date [date]="startingDate$ | async" (dateChange)="date.next($event)"></venite-date>

    <!-- Choose liturgy -->
    <venite-liturgy-menu (liturgyChange)="liturgy.next($event)" [properLiturgy]="properLiturgy | async"></venite-liturgy-menu>

    <!-- Choose vigil -->
    <ion-item>
      <ion-label>{{ 'vigil' | translate }}</ion-label>
      <ion-checkbox name="isVigil" [value]="vigil | async" (ionChange)="vigil.next($event.detail.checked)"></ion-checkbox>
    </ion-item>

    <venite-proper-liturgy-menu
      [day]="liturgicalDay | async"
      [language]="(liturgy | async)?.language"
      (properLiturgyChange)="properLiturgy.next($event)"
    ></venite-proper-liturgy-menu>

    <!-- Pray Button -->
    <ng-container *ngIf="prayData | async as data else notLoaded">
      <ion-button (click)="pray(data)">
        <ion-label>{{ 'Pray' | translate }}</ion-label>
      </ion-button>
    </ng-container>
    <ng-template #notLoaded>
      <ion-button disabled="true">
        <ion-label>{{ 'Pray' | translate }}</ion-label>
      </ion-button>
    </ng-template>

    <!-- Preferences -->
    <venite-liturgy-preference-menu
      [liturgy]="liturgy | async"
      (clientPreferencesChange)="clientPreferences.next($event)"
    ></venite-liturgy-preference-menu>
  </ion-card-content>
</ion-card>