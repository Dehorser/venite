<form *ngIf="preference_tree && categories" [formGroup]="form">
  <ng-container *ngFor="let category of categories">
    <ion-list *ngIf="preference_tree[category].length > 0">
      <ion-item><h4>{{ category }}</h4></ion-item>
      <ng-container *ngFor="let item of preference_tree[category]">
        <!-- item[0] is the key, item[1] is the Preference -->
        <ion-item *ngIf="item[1]?.options?.length > 1">
          <ion-label position="stacked">{{ item[1].label }}</ion-label>
          <ion-select ngDefaultControl [formControlName]="item[0]" (ionChange)="change(item[0], $event.detail.value)">
            <ion-select-option *ngFor="let opt of item[1]?.options; let ii = index"
              [value]="opt.value">
              {{ opt.label }}
            </ion-select-option>
          </ion-select>
          <ion-text class="preference-description" *ngIf="item[1]?.description" [innerHTML]="item.value.description"></ion-text>
        </ion-item>
      </ng-container>
    </ion-list>
  </ng-container>
</form>
